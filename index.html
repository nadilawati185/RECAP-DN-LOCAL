const roundDN = (value) => {
  const num = parseInt(value);
  const remainder = num % 10;
  if (remainder >= 3 && remainder <= 4) return Math.floor(num / 10) * 10 + 5;
  if (remainder <= 2) return Math.floor(num / 10) * 10;
  return num; // Default for other values
};
const roundDN = (value) => {
  const num = parseInt(value);
  const remainder = num % 10;
  if (remainder >= 3 && remainder <= 4) return Math.floor(num / 10) * 10 + 5;
  if (remainder <= 2) return Math.floor(num / 10) * 10;
  return num; // Default for other values
};
import React, { useState, useEffect } from 'react';
import { initializeApp } from "firebase/app";
import { getDatabase, ref, push, onValue, remove, update } from "firebase/database";
import Chart from 'react-apexcharts'; // For Bar/Line Graphs
import FullCalendar from '@fullcalendar/react';
import dayGridPlugin from '@fullcalendar/daygrid';
import { saveAs } from 'file-saver';
import jsPDF from 'jspdf';
import 'jspdf-autotable';

[span_1](start_span)// Config from source[span_1](end_span)
const firebaseConfig = {
  apiKey: "AIzaSyAEZA47N7205zjQEKT2iSViQJvCwLEzusg",
  authDomain: "dn-ikk.firebaseapp.com",
  databaseURL: "https://dn-ikk-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "dn-ikk",
  appId: "1:121412700238:web:598d91bcebc6976a615b1f"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

export default function OrderDNApp() {
  const [orders, setOrders] = useState([]);
  const [theme, setTheme] = useState('professional');
  const [search, setSearch] = useState('');

  // 1. CRUD Operations
  const addOrder = (newData) => {
    const ordersRef = ref(db, 'orders');
    push(ordersRef, { ...newData, timestamp: Date.now(), createdBy: 'IKK' });
  };

  // 2. Export Functions (PDF, Excel, JPG)
  const downloadPDF = () => {
    const doc = new jsPDF();
    doc.text("ORDER DN IKK - INDAH KIAT KARAWANG", 10, 10);
    doc.autoTable({ html: '#dn-table' });
    doc.text(`Created By: IKK`, 10, doc.internal.pageSize.height - 10);
    doc.save('Order_DN_IKK.pdf');
  };

  return (
    <div className={`app-container theme-${theme}`}>
      <header className="flex justify-between p-4 bg-slate-800 text-white">
        <h1>ORDER DN IKK - INDAH KIAT KARAWANG</h1>
        <div className="search-bar">
          <input 
            type="text" 
            placeholder="Search Customer..." 
            onChange={(e) => setSearch(e.target.value)}
            className="text-black p-1 rounded"
          />
        </div>
      </header>

      <main className="grid grid-cols-12 gap-4 p-4">
        {/* Calendar Section */}
        <div className="col-span-4 bg-white p-4 shadow rounded">
          <FullCalendar 
            plugins={[dayGridPlugin]} 
            initialView="dayGridMonth"
            events={orders.map(o => ({ title: o.customer, date: o.date }))}
          />
        </div>

        {/* Table Section */}
        <div className="col-span-8 bg-white p-4 shadow rounded">
          <table id="dn-table" className="w-full text-left border-collapse">
            <thead>
              <tr className="bg-gray-100">
                <th>Customer</th>
                <th>Destination</th>
                <th>BU</th>
                <th>Target New DN (MT)</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {orders.filter(o => o.customer.toLowerCase().includes(search.toLowerCase())).map(order => (
                <tr key={order.id}>
                  <td>{order.customer}</td>
                  <td>{order.destination}</td>
                  <td>{order.buType}</td>
                  <td>{order.targetDn}</td>
                  <td>
                    <button onClick={() => remove(ref(db, `orders/${order.id}`))}>Delete</button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </main>

      {/* Analytics Chart */}
      <div className="p-4">
        <Chart 
          type="bar"
          series={[{ name: 'DN Target', data: orders.map(o => o.targetDn) }]}
          options={{ chart: { id: 'basic-bar' }, xaxis: { categories: orders.map(o => o.customer) }}}
        />
      </div>
    </div>
  );
}

// Struktur Data Tema di Settings
const themes = {
  professional: {
    primary: "#1e293b", // Slate 800
    secondary: "#f8fafc",
    text: "#000000",
    font: "Inter, sans-serif"
  },
  cherry: {
    primary: "#ff4d6d", // Cherry Pink
    secondary: "#fff0f3",
    text: "#590d22",
    font: "Poppins, sans-serif"
  },
  anime: {
    primary: "#6d5dfc", 
    secondary: "#e4e7ee",
    text: "#2d3436",
    font: "Comic Sans MS, cursive",
    background: "url('anime-bg.jpg')"
  }
};